<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Слайдер</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <!-- Подключение стилей и скрипта Glide -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Glide.js/3.0.2/css/glide.core.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Glide.js/3.0.2/css/glide.theme.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Glide.js/3.0.2/glide.js"></script>
    <style>
        /* Убираем все отступы у страницы */
        body, html {
          margin: 0;
          padding: 0;
          overflow-x: hidden; /* Защита от горизонтальной прокрутки */
        }
        
        /* Сам блок Glide должен растягиваться на 100% ширины обертки */
        .glide {
          width: 100% !important;
        }

        /* На всякий случай сбрасываем стили списка, чтобы Glide считал всё ровно */
        .glide__slides {
          display: flex !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        /* Изображения внутри должны занимать всю ширину слайда */
        .glide__slide img {
            width: 85%;       /* Растягивает по ширине */
            margin-left: auto;
            margin-right: auto;
            display: block;    /* Убирает нижний микро-отступ */
            object-fit: contain; /* Заполняет пространство без искажений */
        }
        
        /* Сбрасываем стандартные стили обертки трека */
        .glide__track {
            margin: 0 !important;
            padding: 0 !important;
            background: transparent !important; /* Убирает серый фон, если он есть */
        }

        /* Убираем любые отступы у слайда */
        .glide__slide {
            padding: 0 !important;
            margin: 0 !important;
        }
        
        .glide__arrow {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          background-color: #cc0000; /* Красный, под стиль стрелок */
          color: white;
          border: none;
          
          /* Центрирование иконки */
          display: flex;
          align-items: center;
          justify-content: center;
          
          cursor: pointer;
          transition: all 0.3s ease;
          padding: 0; /* Убираем лишнее, чтобы круг не стал овалом */
        }

        /* Размер самой иконки */
        .glide__arrow i {
          font-size: 20px;
        }

        .glide {
            position: relative;
            padding-top: 55px;
        }

        /* Общие стили для обоих блоков */
        .dynamic-title-top, .dynamic-info-bottom {
          position: absolute;
          left: 10px;
          right: 10px;
          z-index: 10;
          padding: 12px 15px;
          
          /* Белый, но очень прозрачный */
          background-color: rgba(255, 255, 255, 0.4);
          
          /* Магия для Safari: сильное размытие + повышение насыщенности */
          -webkit-backdrop-filter: blur(20px) saturate(180%);
          backdrop-filter: blur(20px) saturate(180%);
          
          /* Убираем серый оттенок принудительным слоем */
          transform: translateZ(0);
          
          font-family: 'Roboto', sans-serif;
          color: #000;
          text-align: center;
          border-radius: 12px;
          border: 1px solid rgba(255, 255, 255, 0.5);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* Ссылка внутри светлого блока комментария */
        .dynamic-info-bottom a {
          color: white;
          text-decoration: underline;
          font-weight: bold;
          pointer-events: auto;
          transition: color 0.2s;
        }

        .dynamic-info-bottom a:hover {
          color: #000000;
          text-decoration: none;
        }

        /* Верхний блок (заголовок) */
        .dynamic-title-top {
          top: 10px;
          font-size: 18px;
          font-weight: bold;
          color: #d32f2f;
        }

        /* Нижний блок (комментарий) */
        .dynamic-info-bottom {
          bottom: 10px;
          font-size: 16px;
          pointer-events: none;
          background-color: #ff4d4d; /* Красный, под стиль стрелок */
          color: white;
        }

        /* Анимации из прошлого примера */
        @keyframes slideDown {
          from { opacity: 0; transform: translateY(-15px); }
          to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
          from { opacity: 0; transform: translateY(15px); }
          to { opacity: 1; transform: translateY(0); }
        }

        /* Стандартное состояние стрелок */
        .glide__arrow {
          transition: opacity 0.3s ease, visibility 0.3s ease;
          opacity: 1;
          visibility: visible;
        }

        /* Кнопка "Дальше" в самом низу */
        .dynamic-next-button {
          position: absolute;
          bottom: 20px; /* Самый низ */
          left: 50%;
          transform: translateX(-50%);
          z-index: 15;
          
          padding: 10px 25px;
          background-color: #cc0000; /* Красный, под стиль стрелок ff4d4d*/
          color: white;
          border: none;
          border-radius: 25px;
          font-size: 14px;
          font-weight: bold;
          text-transform: uppercase;
          cursor: pointer;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
          transition: background 0.3s, transform 0.2s;
          pointer-events: auto; /* Чтобы кнопка нажималась */
          
          white-space: nowrap;    /* Запрещает перенос строки */
          overflow: hidden;       /* Скрывает текст, который не помещается */
          text-overflow: ellipsis; /* Добавляет "..." в конце */
        }

        .dynamic-next-button:hover {
          background-color: #cc0000;
          transform: translateX(-50%) scale(1.05);
        }

        .dynamic-next-button:active {
          transform: translateX(-50%) scale(0.95);
        }

        /* Поднимаем блок комментария чуть выше, чтобы он не перекрывал кнопку */
        .dynamic-info-bottom {
          bottom: 70px; /* Увеличили отступ снизу, чтобы кнопка влезла под него */
        }

        /* Общий класс для скрытия (используется и для стрелок, и для кнопки) */
        .arrow-hidden {
          opacity: 0 !important;
          visibility: hidden !important;
          pointer-events: none !important;
        }

        /* Слой затемнения */
        .fullscreen-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.9);
          backdrop-filter: blur(10px); /* Размытие в стиле Material You */
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 2000;
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.3s ease, visibility 0.3s;
        }

        /* Когда активно */
        .fullscreen-overlay.visible {
          opacity: 1;
          visibility: visible;
        }

        /* Изображение с анимацией увеличения */
        .fullscreen-overlay img {
          max-width: 95%;
          max-height: 95%;
          border-radius: 24px; /* Крупные углы Android 2026 */
          transform: scale(0.8);
          transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Пружинистая анимация */
        }

        .fullscreen-overlay.visible img {
          transform: scale(1);
        }

        /* Кнопка закрытия */
        .close-btn {
          position: absolute;
          top: 30px;
          right: 30px;
          color: white;
          font-size: 40px;
          cursor: pointer;
          z-index: 2100;
        }

    </style>
</head>
<body>
    <div class="glide_parent">
        <div class="glide">
            <div class="glide__track" data-glide-el="track">
                <!-- Сюда скрипт вставит слайды -->
                <ul class="glide__slides" id="glide-render-target"></ul>
            </div>
            
            <div class="glide__arrows" data-glide-el="controls">
                <button class="glide__arrow glide__arrow--left" data-glide-dir="<">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button class="glide__arrow glide__arrow--right" data-glide-dir=">">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Окно полноэкранного просмотра -->
    <div id="fullscreen-overlay" class="fullscreen-overlay" onclick="closeFullscreen()">
        <span class="close-btn">&times;</span>
        <img id="fullscreen-img" src="" alt="Full Screen">
    </div>

    <script>
    function openFullscreen() {
      // Находим текущее активное изображение в вашем слайдере
      const activeSlideImg = document.querySelector('.glide__slide--active img'); // Укажите селектор вашего слайда
      const overlay = document.getElementById('fullscreen-overlay');
      const fullImg = document.getElementById('fullscreen-img');

      if (activeSlideImg) {
        fullImg.src = activeSlideImg.src; // Копируем путь к картинке
        overlay.classList.add('visible');
        document.body.style.overflow = 'hidden'; // Блокируем прокрутку фона
      }
    }

    function closeFullscreen() {
      const overlay = document.getElementById('fullscreen-overlay');
      overlay.classList.remove('visible');
      document.body.style.overflow = 'auto'; // Возвращаем прокрутку
    }

    function initSlider() {
      try {
        // 1. Получаем параметр ?page= из URL
        const urlParams = new URLSearchParams(window.location.search);
        const currentPageId = urlParams.get('page') || 'buy';

        // 2. Читаем JSON прямо из HTML-тега
        const jsonData = document.getElementById('slider-data').textContent;
        const allDataArray = JSON.parse(jsonData);
        const pageData = allDataArray.find(item => item.page === currentPageId);

        if (!pageData || !pageData.slides) return;

        const slideData = pageData.slides;
        const renderTarget = document.getElementById('glide-render-target');

        // 3. Динамическая генерация слайдов
        renderTarget.innerHTML = slideData.map(slide => `
          <li class="glide__slide">
            <img src="images/${slide.image}" alt="${slide.title}" onclick="openFullscreen()">
          </li>
        `).join('');

        // 4. Инициализация Glide (только ПОСЛЕ генерации HTML)
        const glide = new Glide('.glide', {
          type: 'slider',
          perView: 1,
          rewind: false,
          gap: 0
        });

        // Создаем наложения
        const titleOverlay = document.createElement('div');
        titleOverlay.className = 'dynamic-title-top';
        const infoOverlay = document.createElement('div');
        infoOverlay.className = 'dynamic-info-bottom';
        
        const glideParent = document.querySelector('.glide_parent');
        const glideContainer = document.querySelector('.glide');
        glideParent.prepend(titleOverlay);
        glideParent.appendChild(infoOverlay);

        const leftArrow = document.querySelector('.glide__arrow--left');
        const rightArrow = document.querySelector('.glide__arrow--right');

        // Создаем кнопку "Дальше"
        const nextBtn = document.createElement('button');
        nextBtn.className = 'dynamic-next-button';
        nextBtn.textContent = 'Дальше';
        glideParent.appendChild(nextBtn);
        
        // Обработчик клика
        nextBtn.addEventListener('click', () => {
          glide.go('>'); // Команда Glide перейти к следующему слайду
        });

        // Создаем кнопку "Вернуться"
        const finishBtn = document.createElement('button');
        finishBtn.className = 'dynamic-next-button';
        finishBtn.textContent = 'На главную страницу приложения >';
        glideParent.appendChild(finishBtn);

        // Обработчик клика
        finishBtn.addEventListener('click', () => {
            window.location.href = 'https://faberlic.com/index.php?option=com_user&view=login';
        });

        function updateUI() {
          const data = slideData[glide.index];
          const totalSlides = slideData.length;

          if (data) {
            titleOverlay.textContent = data.title;
            infoOverlay.innerHTML = data.comment;
          }

          // Скрытие стрелок
          leftArrow.classList.toggle('arrow-hidden', glide.index === 0);
          rightArrow.classList.toggle('arrow-hidden', glide.index === totalSlides - 1);
          
          // Скрываем кнопку "Дальше" на последнем слайде
          const isLastSlide = (glide.index === totalSlides - 1)
          if (nextBtn) {
            nextBtn.classList.toggle('arrow-hidden', isLastSlide);
          }
          if (finishBtn) {
              finishBtn.classList.toggle('arrow-hidden', !isLastSlide);
          }
            
          // Анимация текста
          [titleOverlay, infoOverlay].forEach(el => {
            el.style.animation = 'none';
            el.offsetHeight;
          });
          titleOverlay.style.animation = 'slideDown 0.4s ease-out forwards';
          infoOverlay.style.animation = 'slideUp 0.4s ease-out forwards';
        }

        glide.on(['run.after'], updateUI);
        glide.mount();
        updateUI();

      } catch (error) {
        console.error('Ошибка:', error);
      }
    }

    // Запускаем сразу, так как fetch ждать не нужно
    document.addEventListener('DOMContentLoaded', initSlider);

</script>

<script id="slider-data" type="application/json">
[
 {
     "page": "buy",
     "slides": [
       { "image": "buy1.png", "title": "Сделать покупку - поиск товара",
         "comment": "Нажмите на иконку с лупой для перехода к быстрому поиску товара."},
       { "image": "buy2.png", "title": "Текст для поиска и выбор товара",
         "comment": "Введите в поисковой строке текст для поиска и выберите в результатах поиска нужный товар."},
       { "image": "buy3.png", "title": "Добавление в корзину",
         "comment": "Нажмите кнопку в нижней части экрана для добавления товара в корзину."},
       { "image": "buy4.png", "title": "Переход в корзину",
         "comment": "После того, как добавили все необходимые товары, нажмите на иконку с корзиной."},
       { "image": "buy5.png", "title": "Работа с корзиной",
         "comment": "Убедитесь, что добавлены все нужные товары и нажмите кнопку \"Продолжить\"."},
       { "image": "buy6.png", "title": "Выбор товаров по акциям",
         "comment": "Выберите товары по акциям и нажмите кнопку \"Продолжить\"."},
       { "image": "buy6a.png", "title": "Выбор получателя",
         "comment": "При необходимости уточните кто будет получать заказ."},
       { "image": "buy6b.png", "title": "Выбор способа доставки",
         "comment": "Выберите способ доставки заказа."},
       { "image": "buy7.png", "title": "Подтверждение заказа",
         "comment": "Убедитесь, что все нужные товары в заказе и нажмите кнопку \"Подтвердить заказ\"."},
       { "image": "buy8.png", "title": "Переход к оплате",
         "comment": "Сразу после утверждения заказа можно перейти к его оплате, нажав на кнопку внизу экрана"},
       { "image": "buy9.png", "title": "Оплата утвержденного заказа",
         "comment": "При необходимости уточните способ оплаты и нажмите кнопку \"Оплатить\"."}
     ]
   },
    {
     "page": "myorder",
     "slides": [
       { "image": "icon_menu.png", "title": "Меню \"Мой профиль\"",
         "comment": "Нажмите на иконку с \"человечком\" в правом верхнем углу."},
       { "image": "orders_step_2.png", "title": "Пункт \"Мои заказы\"",
         "comment": "В появившемся меню выберите пункт \"Мои заказы\"."},
       { "image": "orders_step_3.png", "title": "Переход к списку заказов",
         "comment": "Прокрутите содержимое следующей страницы <b>вниз почти до самого конца</b>, чтобы увидеть таблицу со списком заказов.\n Если нажать на  ссылку с номером заказа, Вы перейдёте в карточку этого заказа."},
       { "image": "orders_step_4.png", "title": "Место получения заказа",
         "comment": "Также таблицу с заказами можно <b>прокрутить вправо</b>, чтобы увидеть место получения заказа. \n Если нажать на  ссылку с адресом, Вы перейдёте в карточку с дополнительной информацией о месте получения."}
     ]
   },
   {
     "page": "feedback",
     "slides": [
       { "image": "icon_menu.png", "title": "Меню \"Мой профиль\"",
         "comment": "Нажмите на иконку с \"человечком\" в правом верхнем углу."},
       { "image": "feedback_menu.png", "title": "Пункт \"Обратная связь\"",
         "comment": "В появившемся меню выберите пункт \"Обратная связь\"."},
       { "image": "feedback_add.png", "title": "Создать новую заявку",
         "comment": "В появившемся окне нажмите кнопку + (плюс) чтобы  создать новую заявку."},
       { "image": "feedback_form.png", "title": "Заполнить поля и отправить",
         "comment": "Заполните поля \"Тема заявки\" и \"Описание заявки\", далее нажмите кнопку \"Создать заявку\"."},
       { "image": "feedback_answer.png", "title": "Где будет ответ на заявку",
         "comment": "Позже, чтобы увидеть <b>ответ на свою заявку</b>, нажмите на кнопку меню в левом верхнем углу формы и выберите пункт \"Получен ответ\" или \"Выполнено\". Текст ответа будет написан <b>в продолжении текста</b> Вашей заявки. Также копия ответа будет отправлена на адрес электронной почты, который указали при регистрации."}
     ]
   },
   {
     "page": "about",
     "slides": [
       { "image": "3.jpg", "title": "Проект Альфа",
         "comment": "Узнайте больше о наших <a href='/about' class='inline-link'>технологиях</a> и методах работы."},
       { "image": "2.jpg", "title": "Галерея работ",
         "comment": "Все фотографии доступны в нашем <a href='/instagram' class='inline-link'>профиле соцсетей</a>."},
       { "image": "1.jpg", "title": "Связаться с нами",
         "comment": "Остались вопросы? <a href='mailto:info@site.com' class='inline-link'>Напишите нам письмо</a> прямо сейчас."}
     ]
   }
]
</script>
</body>
</html>
